---
title: "Worked Example 6 - Power Calculations"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Worked Example 6 - Power Calculations}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(root.dir = system.file("extdata",package="vectorpower"))
```

This is an example of how to take previously created main population data and and calculate the statistical power of a hypothetical field trial where the control and intervention clusters are drawn from said data.

First load the package (install it first if necessary as shown in the [Installation article](https://keithjf82.github.io/vectorpower/articles/B_installation.html):

```{r setup}
library(vectorpower)
```

In this example, the main population data set is loaded from an RDS file created by saving the results of running the mainpop() function (see [Worked Example 2](https://keithjf82.github.io/vectorpower/articles/D_worked_example02.html)).

```{r}
# Load main population data
mainpop_data <- readRDS(file=url("https://github.com/KeithJF82/vectorpower/raw/master/inst/extdata/mainpop_data.Rds"))
```

[Note on displaying year-round data TBA]

```{r}
data_view1=data.frame(n=mainpop_data$annual_data$n_mv,EIR_annual=mainpop_data$annual_data$EIRy)
matplot(x=data_view1$n,y=data_view1$EIR_annual,type="p",pch=1,xlab="Dataset",ylab="Annual EIR")
```

[Note on displaying mainpop results TBA]

```{r}
data_view2=get_mainpop_data(input_list=mainpop_data,benchmark="EIR",set_n_mv=mainpop_data$n_mv_set)
plot_mainpop_data(data_view2)
```

Power is computed using the power_compute() function. [Explanation of parameter settings TBA]

```{r, include = FALSE}
# Run power calculation
results<-
power_compute(mainpop_data=mainpop_data,n_clusters=2,n_patients=25,data_level="Individual",alpha=0.05,
              effect_size_sign="Positive",trial_type="sup",delta_eq=NULL,delta_ni=NULL,n_sims=1000,
              benchmark="EIR_annual",age_start=0.5,age_end=10.0,test_time_values=10.0*c(1:14),
              test_type="RDT",flag_pre_clearing=1,censor_period=14.0,flag_reactive_treatment=1,prop_T_c=0.9,
              benchmark_mean=0.3,benchmark_stdev=0.05,int_mean=0.1,int_stdev=0.0)
# Output result
power = results$power_estimate
power
```
