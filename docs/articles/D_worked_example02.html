<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Worked Example 2 - Main Population Calculations â€¢ vectorpower</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Worked Example 2 - Main Population Calculations">
<meta property="og:description" content="vectorpower">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vectorpower</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_package_intro.html">Package introduction</a>
    </li>
    <li>
      <a href="../articles/B_installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/C_worked_example01.html">Worked Example 1 - Data Creation</a>
    </li>
    <li>
      <a href="../articles/D_worked_example02.html">Worked Example 2 - Main Population Calculations</a>
    </li>
    <li>
      <a href="../articles/E_worked_example03.html">Worked Example 3 - Cohort Setup</a>
    </li>
    <li>
      <a href="../articles/F_worked_example04.html">Worked Example 4 - Cohort Simulation</a>
    </li>
    <li>
      <a href="../articles/G_worked_example05.html">Worked Example 5 - Combined Trial Modelling</a>
    </li>
    <li>
      <a href="../articles/H_worked_example06.html">Worked Example 6 - Power Calculations</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="D_worked_example02_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="D_worked_example02_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Worked Example 2 - Main Population Calculations</h1>
            
      
      
      <div class="hidden name"><code>D_worked_example02.Rmd</code></div>

    </div>

    
    
<p>This is an example of how to load a dataset and carry out simulations of the progression of malaria in the main (non-cohort) population.</p>
<p>First load the package (install it first if necessary as shown in the <a href="https://keithjf82.github.io/vectorpower/articles/B_installation.html">Installation article</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">vectorpower</span><span class="op">)</span></code></pre></div>
<p>Next create the list of input file locations to supply to the mainpop() function. Here the files are located online, so the list is created manually:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  param_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KeithJF82/vectorpower/master/inst/extdata/DemoFolder1/model_parameters.txt"</span><span class="op">)</span>,
  age_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KeithJF82/vectorpower/master/inst/extdata/DemoFolder1/age_data.txt"</span><span class="op">)</span>,
  het_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KeithJF82/vectorpower/master/inst/extdata/DemoFolder1/het_data.txt"</span><span class="op">)</span>,
  start_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KeithJF82/vectorpower/master/inst/extdata/DemoFolder1/start_data.txt"</span><span class="op">)</span>,
  annual_file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KeithJF82/vectorpower/master/inst/extdata/DemoFolder1/annual_data.txt"</span><span class="op">)</span>
                    <span class="op">)</span></code></pre></div>
<p>If using a dataset folder created using dataset_create(), this can be done automatically by using the load_dataset() function. Here the example folder in the inst/extdata subfolder, created in the first worked example, is used:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataset_folder</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/DemoFolder1/"</span>,package<span class="op">=</span><span class="st">"vectorpower"</span><span class="op">)</span>
<span class="va">input_files</span> <span class="op">&lt;-</span> <span class="fu">load_dataset</span><span class="op">(</span><span class="va">dataset_folder</span><span class="op">)</span></code></pre></div>
<p>The parameters defining the trial setup are then supplied to be used by mainpop():</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Length of time to run main population model from starting date before intervention begins</span>
<span class="va">start_interval</span> <span class="op">=</span> <span class="fl">0.0</span>  
<span class="co"># Time points after the end of the starting interval at which benchmark data should be output</span>
<span class="va">time_values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> 
<span class="co"># List of sets of values to load from starting data</span>
<span class="va">n_mv_set</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> 
<span class="co"># Intervention parameter given variable value (0 = None, 1 = ATSB mortality, 2 = bednet coverage, 3 = Interior residual spraying coverage, 4 = SET coverage)</span>
<span class="va">int_v_varied</span> <span class="op">=</span> <span class="fl">1</span> 
<span class="co"># List of intervention parameter values ()</span>
<span class="va">int_values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0</span>,<span class="fl">0.1</span><span class="op">)</span> </code></pre></div>
<p>The parameters and list of input files are passed to the load_inputs function, which creates a set of data for input.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_inputs.html">load_inputs</a></span><span class="op">(</span>input_files<span class="op">=</span><span class="va">input_files</span>, n_mv_set<span class="op">=</span><span class="va">n_mv_set</span><span class="op">)</span></code></pre></div>
<p>The input data set and the other trial parameters are then passed to the mainpop() function, which runs the deterministic continuum malaria model, the code for which is found in mainpop.cpp in the src/ folder.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mainpop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mainpop.html">mainpop</a></span><span class="op">(</span>input_data <span class="op">=</span> <span class="va">input_data</span>, int_v_varied <span class="op">=</span> <span class="va">int_v_varied</span>, 
                        int_values<span class="op">=</span><span class="va">int_values</span>, start_interval <span class="op">=</span> <span class="va">start_interval</span>, time_values<span class="op">=</span><span class="va">time_values</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 1 Mosquito density=12.21 Intervention number=0 dt=0.0286182</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0</span>
<span class="co">#&gt; Run 1 complete. dt=0.0286182</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 2 Mosquito density=12.21 Intervention number=1 dt=0.0286182</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0.1</span>
<span class="co">#&gt; Run 2 complete. dt=0.0286182</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 3 Mosquito density=14.55 Intervention number=0 dt=0.0262161</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0</span>
<span class="co">#&gt; Run 3 complete. dt=0.0262161</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 4 Mosquito density=14.55 Intervention number=1 dt=0.0262161</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0.1</span>
<span class="co">#&gt; Run 4 complete. dt=0.0262161</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 5 Mosquito density=16.9 Intervention number=0 dt=0.0243252</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0</span>
<span class="co">#&gt; Run 5 complete. dt=0.0243252</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 6 Mosquito density=16.9 Intervention number=1 dt=0.0243252</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0.1</span>
<span class="co">#&gt; Run 6 complete. dt=0.0243252</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 7 Mosquito density=19.25 Intervention number=0 dt=0.0227921</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0</span>
<span class="co">#&gt; Run 7 complete. dt=0.0227921</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 8 Mosquito density=19.25 Intervention number=1 dt=0.0227921</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0.1</span>
<span class="co">#&gt; Run 8 complete. dt=0.0227921</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 9 Mosquito density=21.6 Intervention number=0 dt=0.0215166</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0</span>
<span class="co">#&gt; Run 9 complete. dt=0.0215166</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 10 Mosquito density=21.6 Intervention number=1 dt=0.0215166</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0.1</span>
<span class="co">#&gt; Run 10 complete. dt=0.0215166</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 11 Mosquito density=23.95 Intervention number=0 dt=0.0204337</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0</span>
<span class="co">#&gt; Run 11 complete. dt=0.0204337</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Run 12 Mosquito density=23.95 Intervention number=1 dt=0.0204337</span>
<span class="co">#&gt; Intervention begun. ATSB kill rate=0.1</span>
<span class="co">#&gt; Run 12 complete. dt=0.0204337</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Computations complete.</span></code></pre></div>
<p>The resulting data can be used in cohort calculations or processed on its own. It can be saved to a file so that it can be used again if R is closed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">mainpop_data</span>,file<span class="op">=</span><span class="st">"mainpop_data.Rds"</span><span class="op">)</span></code></pre></div>
<p>The get_mainpop_data() function can be used to obtain selected results, which can then be plotted as graphs using the plot_mainpop_data() function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mainpop_data.html">get_mainpop_data</a></span><span class="op">(</span>input_list<span class="op">=</span><span class="va">mainpop_data</span>,set_n_mv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,set_n_int<span class="op">=</span><span class="fl">1</span>,benchmark<span class="op">=</span><span class="st">"slide_prev"</span>,age_start<span class="op">=</span><span class="fl">0.0</span>,age_end <span class="op">=</span> <span class="fl">65.0</span><span class="op">)</span>
<span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mainpop_data.html">get_mainpop_data</a></span><span class="op">(</span>input_list<span class="op">=</span><span class="va">mainpop_data</span>,set_n_mv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,set_n_int<span class="op">=</span><span class="fl">2</span>,benchmark<span class="op">=</span><span class="st">"slide_prev"</span>,age_start<span class="op">=</span><span class="fl">0.0</span>,age_end <span class="op">=</span> <span class="fl">65.0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_mainpop_data.html">plot_mainpop_data</a></span><span class="op">(</span><span class="va">plot1</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_mainpop_data.html">plot_mainpop_data</a></span><span class="op">(</span><span class="va">plot2</span><span class="op">)</span></code></pre></div>
<p><img src="D_worked_example02_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For the creation of cohort data from main population data, see <a href="https://keithjf82.github.io/vectorpower/articles/E_worked_example03.html">Worked Example 3</a>.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Keith Fraser.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
